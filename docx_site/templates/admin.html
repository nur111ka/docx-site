{% extends "base.html" %}

{% block content %}
<h1>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>

<div class="tabs">
    <button class="tab" data-tab="templates-tab">üìÅ –®–∞–±–ª–æ–Ω—ã</button>
    <button class="tab active" data-tab="keys-tab">üîë API –ö–ª—é—á–∏</button>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ -->
<div id="templates-tab" class="tab-content">
    <div class="card">
        <h3>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏</h3>
        <a href="{{ url_for('manage_templates') }}" class="btn">
            ‚öôÔ∏è –ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —à–∞–±–ª–æ–Ω–∞–º–∏
        </a>
        <p style="margin-top: 10px;">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.</p>
    </div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ API –∫–ª—é—á–µ–π -->
<div id="keys-tab" class="tab-content active">
    <div class="card">
        <h3>üîê –°–æ–∑–¥–∞—Ç—å API –∫–ª—é—á</h3>
        
        <form method="POST" action="{{ url_for('admin') }}">
            <input type="hidden" name="action" value="create_key">
            
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω:</label>
                <select name="key_client_name" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω...</option>
                    {% for name, display in get_all_templates() %}
                    <option value="{{ name }}">{{ display }} ({{ name }})</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label>–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π:</label>
                <input type="number" name="limit_count" value="10" min="1" max="1000" required>
            </div>
            
            <button type="submit" class="btn">üîë –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á</button>
        </form>
    </div>
    
    <div class="card">
        <h3>üóùÔ∏è –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π</h3>
        
        {% if keys %}
        <table class="table">
            <thead>
                <tr>
                    <th>API –ö–ª—é—á</th>
                    <th>–®–∞–±–ª–æ–Ω</th>
                    <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°–æ–∑–¥–∞–Ω</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for key in keys %}
                <tr>
                    <td>
                        <code>{{ key.api_key[:16] }}...</code>
                        <button onclick="navigator.clipboard.writeText('{{ key.api_key }}')" 
                                class="copy-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
                            üìã
                        </button>
                    </td>
                    <td>{{ key.template_name }}</td>
                    <td>{{ key.used_count }}/{{ key.limit_count }}</td>
                    <td>
                        {% if key.status == 'active' %}
                        <span style="color: green; font-weight: bold;">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                        <span style="color: red;">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                        {% endif %}
                    </td>
                    <td>{{ key.created_at[:10] }}</td>
                    <td>
                        {% if key.status == 'active' %}
                        <form method="POST" action="{{ url_for('admin') }}" style="display: inline;">
                            <input type="hidden" name="action" value="deactivate_key">
                            <input type="hidden" name="api_key" value="{{ key.api_key }}">
                            <button type="submit" class="btn btn-danger" 
                                    onclick="return confirm('–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á?')">
                                üö´ –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π</p>
        {% endif %}
    </div>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabId = this.dataset.tab;
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        this.classList.add('active');
        document.getElementById(tabId).classList.add('active');
    });
});
</script>
{% endblock %}